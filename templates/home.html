{% extends 'base.html' %}

{% block content %}

<!DOCTYPE html>
<html>
{% load static %}
<head>
  <title>Deep Brain</title>
  <meta charset="utf-8"/>
  <!-- <link rel="stylesheet" type="text/css" href="{% static 'deepb/style.css' %}" /> -->
    <!-- Bootstrap -->
  <!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"> -->
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
  <script language="javascript">
    function required()
    {
        var result = true
        var empt = document.forms["form1"]["gene_file"].value;
        if (empt == "")
        {
            alert("Please upload a gene file");
            result = false;
        }
        empt = document.forms["form1"]["symptom_file"].value;
        if (empt == "")
        {
            alert("Please upload a symptom file");
            result = false;
        }
        empt = document.forms["form1"]["task_name"].value;
        if (empt == "")
        {
            alert("Please enter a task_name");
            result = false;
        }
        return result
    }
  </script>

</head>
<body>
  <div class="container">
      <h3>Please upload your task:</h3>
  </br>
    <form name="form1" method="post" action="{% url 'deepb:upload' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <div class = "container">
        <label>Upload gene file (*required)</label>
        <input type="file" name="gene_file">   
      </div>
      <p></p>
      <p></p>
      <p></p>
      <div class = "container">
        <label>Upload phenotype file (*required)</label>
        <input type="file" name="symptom_file">
      </div>
      <p></p>
      <p></p>
      <p></p>
      <div class = "container">
        <input type="text" name="task_name" placeholder="Please enter a task name">
        <label>(*required)</label><br />
      </div>
      <p></p>
      <p></p>
      <p></p>
      <div class = "container">
        <button type="submit", onClick="return required()">Run task</button>
      </div>
    </form>

    <br />
    <div id="results">
      <h3>All your tasks:</h3>
    {% for result in latest_task_list %}
      {% if result.status == 'In progress' %}
        Task name: &nbsp;
        {{ result.raw_input_table.task_name }}<br />
        Task status: In progress<br />
        Task submit time: &nbsp;
        {{ result.raw_input_table.pub_date }}<br />
      {% elif result.status == 'Failed'%}
        Task name: &nbsp;
        {{ result.raw_input_table.task_name }}<br />
        Task status: Failed<br />
        Task submit time: &nbsp;
        {{ result.raw_input_table.pub_date }}<br />
      {% elif result.status == 'Succeed' %}
        Task name: &nbsp;
        {{ result.raw_input_table.task_name }} &nbsp;
        <a href="{% url 'deepb:result' result.main_table_id %}">Click to see results</a><br />
        Task status: Succeed<br />
        Task submit time: &nbsp;
        {{ result.raw_input_table.pub_date }}<br />
      {% else %}
        Task name: &nbsp;
        {{ result.raw_input_table.task_name }}<br />
        Task status: Server Error<br />
        Task submit time: &nbsp;
        {{ result.raw_input_table.pub_date }}<br />
      {%  endif %}
      <br />
    {% endfor %}
    </div>
  </div>  
</body>
{% endblock %}
